<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5"> <script> const darkBtn = "Dark"; const lightBtn = "Light"; const isAutoTheme = false; const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; if (isAutoTheme) { document.documentElement.setAttribute('data-theme', sessionStorage.getItem('theme') ?? preferredTheme); } else { document.documentElement.setAttribute('data-theme', "dark"); } </script> <script defer src="/chkbit/assets/js/main.min.js"></script><link rel="stylesheet" href="/chkbit/assets/css/main.css"><link rel="shortcut icon" href="/chkbit/assets/favicon.ico" type="image/x-icon"> <script src="/chkbit/assets/js/vendor/simple-jekyll-search.min.js"></script> <script> const cookieName = 'cookie-notice-dismissed-https://laktak.github.io'; const isCookieConsent = 'false'; const analyticsName = ''; const analyticsNameGA4 = ''; </script><meta property="og:image" content="https://laktak.github.io/chkbit/assets/img/none"><meta property="og:type" content="website"/><title>File Deduplication | chkbit</title><meta name="generator" content="Jekyll v4.4.1"/><meta property="og:title" content="File Deduplication"/><meta property="og:locale" content="en_US"/><meta name="description" content="Check your files for data corruption and run file deduplication"/><meta property="og:description" content="Check your files for data corruption and run file deduplication"/><link rel="canonical" href="https://laktak.github.io/chkbit/dedup/"/><meta property="og:url" content="https://laktak.github.io/chkbit/dedup/"/><meta property="og:site_name" content="chkbit"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary"/><meta property="twitter:title" content="File Deduplication"/> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Check your files for data corruption and run file deduplication","headline":"File Deduplication","url":"https://laktak.github.io/chkbit/dedup/"}</script><link rel="alternate" type="application/atom+xml" title="chkbit" href="https://laktak.github.io/chkbit/feed.xml"/><link type="application/atom+xml" rel="alternate" href="https://laktak.github.io/chkbit/feed.xml" title="chkbit"/><meta name="twitter:title" content="File Deduplication"><meta name="twitter:description" content="### What is File Deduplication (dedup/dedupe)?File deduplication is a process that eliminates duplicate copies of data. For example if you have 10 identical ..."><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://laktak.github.io/chkbit/assets/img/none"><meta name="twitter:image:alt" content="File Deduplication"><link rel="stylesheet" href="/chkbit/assets/css/custom.css"></head><body> <header class="site-header"><div class="branding"> <a href="/chkbit/"> <img alt="logo img" class="avatar" src="/chkbit/assets/img/logo.png" loading="lazy"/> </a> <a class="site-title" aria-label="chkbit" href="/chkbit/"> chkbit </a></div> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fas fa-bars fa-lg"></i> </a><ul class="hide"><li class="separator"> |</li><li> <a class="clear" aria-label="Install" title="Install" href="/chkbit/get/"> <span class="navbar-label">Install</span> </a></li><li class="separator"> |</li><li> <a class="clear" aria-label="How does it work?" title="How does it work?" href="/chkbit/how/"> <span class="navbar-label">How does it work?</span> </a></li><li class="separator"> |</li><li> <a class="clear" aria-label="File Deduplication" title="File Deduplication" href="/chkbit/dedup/"> <span class="navbar-label">Dedup [NEW]</span> </a></li><li class="separator"> |</li><li> <a class="clear" aria-label="Usage" title="Usage" href="/chkbit/usage/"> <span class="navbar-label">Usage</span> </a></li><li class="separator"> |</li><li> <a class="clear" aria-label="FAQ" title="FAQ" href="/chkbit/faq/"> <span class="navbar-label">FAQ</span> </a></li><li class="separator"> |</li><li> <a class="clear" aria-label="About" title="About" href="/chkbit/about/"> <span class="navbar-label">About</span> </a></li><li class="separator"> |</li><li> <a class="clear" aria-label="Star on GitHub" title="Star on GitHub" href="https://github.com/laktak/chkbit"> <span class="navbar-label">Star on GitHub</span> </a></li></ul> </nav> </header><div class="content"> <article > <header id="main" style="background-image:url('')"><div class="title-padder"><h1 id="File+Deduplication" class="title"> File Deduplication</h1></div> </header> <section class="post-content"><h3 id="what-is-file-deduplication-dedupdedupe">What is File Deduplication (dedup/dedupe)?</h3><p>File deduplication is a process that eliminates duplicate copies of data. For example if you have 10 identical copies of the same file, deduplication would recognize that all 10 copies are the same and store only one copy of the file (using a CoW, copy on write filesystem). The other 9 would just be pointers to that single copy. This can save a lot of space on your storage device.</p><h3 id="finding-duplicate-files">Finding Duplicate Files</h3><p>Because chkbit already stores a hash of every file, it can quickly build a duplicates database. The first initial scan will take some time but then you can only scan for changes.</p><p>Files that already share the same space (either via CoW or hard links) are detected and not included in the reported reclaimable space.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ chkbit dedup detect .
msg collect matching hashes (min=8K)
msg update file sizes (for legacy indexes)
msg collect matching files

- 13s elapsed
- 1049744 files processed
- 75288.61 files/second

Detected 53576 hashes that are shared by 464530 files:
- Minimum required space: 353.7G
- Maximum required space: 3.4T
- Actual used space:      372.4G
- Reclaimable space:      18.7G
- Efficiency:             99.40%
</code></pre></div></div><h3 id="usage">Usage</h3><p>chkbit requires an index to operate</p><ul><li>if you have not used chkbit before <a href="/chkbit/usage/">create an atom index</a></li><li>if you already have an atom index continue to the next step</li><li>if you were using a split index you need to fuse it first with <code class="language-plaintext highlighter-rouge">chkbit fuse .</code> (you can continue to use the split index, this just creates an atom index for dedup detect)</li></ul><p>Run detect to update the dedup database</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ chkbit dedup detect .
</code></pre></div></div><p>On supported systems you will see information about the reclaimable space (see above). Otherwise only basic stats will be shown.</p><p>To view details and a list of identified files run show:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chkbit dedup show . -f
</code></pre></div></div><p>You can also export this data to json: <code class="language-plaintext highlighter-rouge">chkbit dedup show . --json</code></p><p>Finally run dedup either on all identified files</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chkbit dedup run .
</code></pre></div></div><p>or on individual hashes (that were listed by show) with <code class="language-plaintext highlighter-rouge">chkbit dedup run . HASH HASH ...</code>.</p><p>If you wish to manually compare files or run dedup see the <code class="language-plaintext highlighter-rouge">chkbit util</code> command.</p><h3 id="requirements">Requirements</h3><ul><li>chkbit dedup does not create hard links and requires a CoW (copy on write) filesystem</li><li>Detecting duplicates is supported for all OS</li><li>Detecting reclaimable space is supported on Linux and macOS</li><li>Running deduplicate is currently supported on Linux with a CoW filesystem: btrfs, xfs (macOS coming later)</li></ul><p>Deduplication is not possible on Windows with NTFS.</p><h3 id="is-it-safe">Is it Safe?</h3><p>Modern copy on write (CoW) filesystems will automatically create a copy when you write to a deduplicated file, so you do not modify the other shared copies.</p><p>While the deduplication process is as safe as it can be, whenever you handle data you should always have backups in place.</p><p>Deduplication is done via the OS. On Linux/btrfs this is actually an atomic operation where the kernel first verifies that the data matches and only then deduplicates the files.</p><p>After you’ve deduplicated your files you should run <code class="language-plaintext highlighter-rouge">chkbit check</code> to verify that there were no errors.</p><h3 id="how-does-it-work">How does it work?</h3><ul><li>chkbit’s main focus is to detect file corruption. It does this by building a database of hashes (checksums) for every file.</li><li>The same database can be used to identify duplicate files by comparing their checksum (there is a small chance of collisions - these are verified later).</li><li>For each group of files with the same hash, chkbit checks where they are stored on the disk to detect already deduplicated (shared) and still duplicated (exclusive) space.</li><li>Once you decide to deduplicate, chkbit sends the ‘suggested’ duplicates to the Linux kernel for deduplication by the filesystem.</li><li>The kernel verifies that the actual bytes of both files match and then deduplicates the files in an atomic operation.</li><li>The space for the duplicate is now free to use again.</li></ul> </section><div class="tag-list"></div> </article></div></body></html>